function Main_script(mode)
global home spm_defaults config_defaults

% mode - 1 -> local settings
% mode - 2 -> sipba machine

if (mode == 1)
    home = '/Users/XT/Documents/PhD/Granada/neuroimaging';
    dataset_dir = mfullfile(home, 'dataset/');

elseif (mode == 2)
    home = '/home/ivans';
    dataset_dir = '/home/ivans/Alzheimer_data/';
end



% 
% 

load('spm_defaults.mat');
spm_defaults =  defaults;
config_defaults = struct('cerebellum', {mfullfile(home, 'Atlas', 'Cerebellum-MNIsegment.nii')},...
                         'atlas', {mfullfile(home, 'Atlas', 'atlas116.nii')});

% config_defaults = struct('cerebellum', {'/home/ivans/Alzheimer_data/Cerebellum/Cerebellum-MNIsegment.nii'},...
%                          'atlas', {'/home/ivans/Alzheimer_data/Atlas/atlas116.nii'});

if(exist('labels_from_csv.mat', 'file') ~= 2)
    xls_home = mfullfile(home,'csv_dataset/');
    xls_files = strcat(xls_home, {'ADNIMERGE.xlsx', 'DXSUM_PDXCONV_ADNIALL.xlsx'});
    mat_files = strcat(xls_home, {'data_ids.mat', 'data_bl_change.mat'});
    dx_labels = csv_rearrange(xls_home, xls_files, mat_files);
    save('labels_from_csv.mat', 'dx_labels');
else
    load('labels_from_csv.mat');
end

% info = rearangeFolders(dataset_dir, home, dx_labels);
% save ('info.mat');
% beep;

load('info.mat');

rearrangePreFolders(info, dx_labels);

[pathstr, name, ext] = fileparts(config_defaults.atlas);
pr_name = fullfile(pathstr, strcat('r', name, ext));
if(exist(pr_name, 'file') == 2)
    config_defaults.r_atlas = pr_name;
end

% spm_path = mfullfile(home,'matlab_scripts','spm12');
% addpath (genpath(fullfile(home,'matlab_scripts','spm12')));
% spm_defaults.normalise.estimate.tpm = fullfile(spm_path, 'tpm','TPM.nii');

% tmp = {spm_defaults.segment.tissue.tpm};
% ngaus = {spm_defaults.segment.tissue.ngaus};
% native =  {spm_defaults.segment.tissue.native};
% warped = {spm_defaults.segment.tissue.warped};
% for i = 1 : length(tmp)
%     [a, b, c] = fileparts(tmp{i}{1});
%     tmp{i} = {mfullfile(spm_path, 'tpm', [b c])};
% end
% spm_defaults.segment.tissue = struct('tpm',tmp, 'ngaus',ngaus, 'native', native, 'warped',warped); 



scanAndLogMissing(info, dx_labels);

end
